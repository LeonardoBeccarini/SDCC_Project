apiVersion: v1
kind: Namespace
metadata:
  name: cbtest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpbin
  namespace: cbtest
spec:
  replicas: 1
  selector: { matchLabels: { app: httpbin } }
  template:
    metadata:
      labels: { app: httpbin }
    spec:
      containers:
        - name: httpbin
          image: mccutchen/go-httpbin:v2.11.0
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
          readinessProbe:
            httpGet:
              path: /status/200
              port: http
            initialDelaySeconds: 5
            periodSeconds: 2
---
apiVersion: v1
kind: Service
metadata:
  name: httpbin
  namespace: cbtest
spec:
  selector: { app: httpbin }
  ports:
    - name: http
      port: 8080
      targetPort: http
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway
  namespace: cbtest
spec:
  replicas: 1
  selector: { matchLabels: { app: gateway } }
  template:
    metadata:
      labels: { app: gateway }
    spec:
      containers:
        - name: gateway
          # ⚠️ Lo script sovrascrive l'immagine con la TUA: gateway:cbtest (o come definito in IMAGE_NAME)
          image: sdcc/gateway-local:dev
          imagePullPolicy: IfNotPresent
          ports:
            - { name: http, containerPort: 5009 }
          readinessProbe:
            httpGet: { path: /healthz, port: http }
            initialDelaySeconds: 2
            periodSeconds: 2
---
apiVersion: v1
kind: Service
metadata:
  name: gateway
  namespace: cbtest
spec:
  selector: { app: gateway }
  ports:
    - name: http
      port: 5009
      targetPort: http
